"use strict";(self.webpackChunkToolsManagerClientApp=self.webpackChunkToolsManagerClientApp||[]).push([[899],{4899:(ee,A,r)=>{r.r(A),r.d(A,{UsersManagementModule:()=>T});var a=r(6895),d=r(8869),u=r(2771),x=r(1458),e=r(1571),p=r(6858),C=r(2687),R=r(2216);function I(o,s){if(1&o&&(e.TgZ(0,"button",7),e._UZ(1,"fa-icon",6),e.qZA()),2&o){const t=e.oxw(3);e.xp6(1),e.Q6J("icon",t.faCircleInfo)}}const F=function(o){return["/tools-output",o]};function E(o,s){if(1&o&&(e.TgZ(0,"tr")(1,"td"),e._uU(2),e.ALo(3,"date"),e.qZA(),e.TgZ(4,"td"),e._uU(5),e.qZA(),e.TgZ(6,"td"),e.YNc(7,I,2,1,"button",4),e.TgZ(8,"a",5),e._UZ(9,"fa-icon",6),e.qZA()()()),2&o){const t=s.$implicit,i=e.oxw(2);e.xp6(2),e.hij(" ",e.lcZ(3,5,t.outputDateTime)," "),e.xp6(3),e.hij(" ","open"==t.outputToolState.outputToolStateName.toLowerCase()?"Abierto":"Cerrado"," "),e.xp6(2),e.Q6J("ngIf",i.actions),e.xp6(1),e.Q6J("routerLink",e.VKq(7,F,t.outputToolId)),e.xp6(1),e.Q6J("icon",i.faCircleInfo)}}function y(o,s){if(1&o&&(e.TgZ(0,"table",2)(1,"thead")(2,"tr")(3,"th"),e._uU(4," Fecha de salida "),e.qZA(),e.TgZ(5,"th"),e._uU(6," Estado "),e.qZA(),e.TgZ(7,"th"),e._uU(8," Acciones "),e.qZA()()(),e.TgZ(9,"tbody"),e.YNc(10,E,10,9,"tr",3),e.qZA()()),2&o){const t=e.oxw();e.xp6(10),e.Q6J("ngForOf",t.outputsTool)}}function q(o,s){1&o&&(e.TgZ(0,"p"),e._uU(1," No se encontraron salidas de herramienta\n"),e.qZA())}class f{constructor(){this.faCircleInfo=C.DBf}static#e=this.\u0275fac=function(t){return new(t||f)};static#t=this.\u0275cmp=e.Xpm({type:f,selectors:[["output-tool-list"]],inputs:{outputsTool:"outputsTool",actions:"actions"},decls:2,vars:2,consts:[["class","table",4,"ngIf"],[4,"ngIf"],[1,"table"],[4,"ngFor","ngForOf"],["class","action-button",4,"ngIf"],[3,"routerLink"],[1,"text-primary",3,"icon"],[1,"action-button"]],template:function(t,i){1&t&&(e.YNc(0,y,11,1,"table",0),e.YNc(1,q,2,0,"p",1)),2&t&&(e.Q6J("ngIf",i.outputsTool&&i.outputsTool.length),e.xp6(1),e.Q6J("ngIf",i.outputsTool&&!i.outputsTool.length))},dependencies:[a.sg,a.O5,R.BN,d.rH,a.uU]})}function J(o,s){if(1&o&&(e.TgZ(0,"li"),e._uU(1),e.qZA()),2&o){const t=s.$implicit;e.xp6(1),e.hij(" ",t.displayName," ")}}function w(o,s){if(1&o&&(e.TgZ(0,"div",1)(1,"div",2)(2,"p")(3,"b"),e._uU(4,"Nombre: "),e.qZA(),e._uU(5),e.qZA()(),e.TgZ(6,"div",3)(7,"p")(8,"b"),e._uU(9,"Roles:"),e.qZA()(),e.TgZ(10,"ul"),e.YNc(11,J,2,1,"li",4),e.qZA()()()),2&o){const t=e.oxw();e.xp6(5),e.hij(" ",t.user.name,""),e.xp6(6),e.Q6J("ngForOf",t.user.userRoles)}}class _{static#e=this.\u0275fac=function(t){return new(t||_)};static#t=this.\u0275cmp=e.Xpm({type:_,selectors:[["app-user-detail-view"]],inputs:{user:"user"},decls:1,vars:1,consts:[["class","row mt-3 g-2",4,"ngIf"],[1,"row","mt-3","g-2"],[1,"col-12"],[1,"col"],[4,"ngFor","ngForOf"]],template:function(t,i){1&t&&e.YNc(0,w,12,2,"div",0),2&t&&e.Q6J("ngIf",i.user)},dependencies:[a.sg,a.O5]})}var l=r(433);function k(o,s){if(1&o){const t=e.EpF();e.TgZ(0,"li")(1,"div",18)(2,"input",19),e.NdJ("change",function(n){e.CHM(t);const c=e.oxw(2);return e.KtG(c.setUserRoleValue(n))}),e.qZA(),e.TgZ(3,"label",20),e._uU(4),e.qZA()()()}if(2&o){const t=s.$implicit;e.xp6(2),e.Q6J("value",t.userRoleId)("id","userRoles-"+t.userRoleId)("checked",t.isActive),e.xp6(1),e.uIk("for","userRoles-"+t.userRoleId),e.xp6(1),e.hij(" ",t.displayName," ")}}function N(o,s){if(1&o){const t=e.EpF();e.TgZ(0,"div",1)(1,"form",2),e.NdJ("ngSubmit",function(){e.CHM(t);const n=e.oxw();return e.KtG(n.editForm.valid&&n.onSubmit())}),e.TgZ(2,"div",3)(3,"div",4)(4,"label",5),e._uU(5,"Nombre"),e.qZA(),e._UZ(6,"input",6),e.qZA(),e.TgZ(7,"div",4)(8,"label",7),e._uU(9,"Email"),e.qZA(),e._UZ(10,"input",8),e.qZA(),e.TgZ(11,"div",4)(12,"label",9),e._uU(13,"Identificaci\xf3n"),e.qZA(),e._UZ(14,"input",10),e.qZA(),e.TgZ(15,"div",11)(16,"p",12),e._uU(17,"Roles"),e.qZA(),e.TgZ(18,"ul",13),e.YNc(19,k,5,5,"li",14),e.qZA()()(),e.TgZ(20,"div",15)(21,"button",16),e.NdJ("click",function(){e.CHM(t);const n=e.oxw();return e.KtG(n.cancelEditEvent.emit())}),e._uU(22,"Cancelar"),e.qZA(),e.TgZ(23,"button",17),e._uU(24,"Guardar"),e.qZA()()()()}if(2&o){const t=e.oxw();e.xp6(1),e.Q6J("formGroup",t.editForm),e.xp6(18),e.Q6J("ngForOf",t.userRoles),e.xp6(4),e.Q6J("disabled",!t.editForm.dirty&&t.editForm.valid)}}class g{constructor(s,t){this.fb=s,this.httpService=t,this.cancelEditEvent=new e.vpe,this.userUpdatedEvent=new e.vpe}ngOnChanges(){this.initform(),this.filterActiveUserRoles()}initform(){!this.user||(this.editForm=this.fb.group({name:[this.user.name,l.kI.required],email:[this.user.email],idCard:[this.user.idCard,l.kI.required],userRoles:[null]}))}filterActiveUserRoles(){!this.userRoles||!this.user||(this.userRoles=this.userRoles.map(s=>(s.isActive=!!this.user.userRoles.some(t=>t.userRoleId==s.userRoleId),s)),this.filterUserRoleFormValues())}setUserRoleValue(s){const t=this.userRoles.findIndex(i=>i.userRoleId==s.target.value);this.userRoles[t].isActive=s.target.checked,this.editForm.markAsDirty(),this.filterUserRoleFormValues()}filterUserRoleFormValues(){this.editForm?.patchValue({userRoles:this.userRoles.filter(s=>s.isActive).map(s=>s.userRoleId)})}onSubmit(){const s={company:this.user.company,email:this.editForm.controls.email.value,idCard:this.editForm.controls.idCard.value,name:this.editForm.controls.name.value,userId:this.user.userId,userRoles:this.editForm.controls.userRoles.value.map(t=>({userRoleId:t}))};this.httpService.put(u.G8.userApi,s).subscribe(()=>this.userUpdatedEvent.emit())}static#e=this.\u0275fac=function(t){return new(t||g)(e.Y36(l.qu),e.Y36(p.O))};static#t=this.\u0275cmp=e.Xpm({type:g,selectors:[["app-user-detail-edit"]],inputs:{user:"user",userRoles:"userRoles"},outputs:{cancelEditEvent:"cancelEditEvent",userUpdatedEvent:"userUpdatedEvent"},features:[e.TTD],decls:1,vars:1,consts:[["class","row",4,"ngIf"],[1,"row"],[1,"mt-3",3,"formGroup","ngSubmit"],[1,"row","g-2"],[1,"col-md-6"],["for","name",1,"form-label","fw-bold"],["type","text","id","name","formControlName","name",1,"form-control"],["for","email",1,"form-label","fw-bold"],["type","email","id","email","formControlName","email",1,"form-control"],["for","idCard",1,"form-label","fw-bold"],["type","text","id","idCard","formControlName","idCard",1,"form-control"],[1,"col-12"],[1,"fw-bold"],[1,"list-unstyled"],[4,"ngFor","ngForOf"],[1,"form-actions","d-flex","justify-content-center","mt-3"],["type","button",1,"btn","btn-outline-danger","me-2",3,"click"],["type","submit",1,"btn","btn-outline-primary",3,"disabled"],[1,"form-check"],["type","checkbox",1,"form-check-input",3,"value","id","checked","change"],[1,"form-check-label"]],template:function(t,i){1&t&&e.YNc(0,N,25,3,"div",0),2&t&&e.Q6J("ngIf",i.user&&i.editForm)},dependencies:[a.sg,a.O5,l._Y,l.Fj,l.JJ,l.JL,l.sg,l.u]})}var M=r(1066),O=r(2368);function S(o,s){if(1&o){const t=e.EpF();e.TgZ(0,"div",7)(1,"button",8),e.NdJ("click",function(){e.CHM(t);const n=e.oxw(2);return e.KtG(n.setIsEditing(!0))}),e._uU(2,"Editar usuario"),e.qZA()()}}function Y(o,s){if(1&o&&e._UZ(0,"app-user-detail-view",9),2&o){const t=e.oxw(2);e.Q6J("user",t.user)}}function Q(o,s){if(1&o){const t=e.EpF();e.TgZ(0,"app-user-detail-edit",10),e.NdJ("cancelEditEvent",function(){e.CHM(t);const n=e.oxw(2);return e.KtG(n.setIsEditing(!1))})("userUpdatedEvent",function(){e.CHM(t);const n=e.oxw(2);return e.KtG(n.userUpdated())}),e.qZA()}if(2&o){const t=e.oxw(2);e.Q6J("user",t.user)("userRoles",t.userRoles)}}function D(o,s){if(1&o&&(e.TgZ(0,"tr")(1,"td")(2,"a",15),e._uU(3),e.qZA()(),e.TgZ(4,"td")(5,"a",15),e._uU(6),e.qZA()(),e.TgZ(7,"td"),e._uU(8),e.qZA(),e.TgZ(9,"td"),e._uU(10),e.ALo(11,"date"),e.qZA(),e.TgZ(12,"td"),e._uU(13),e.ALo(14,"workState"),e.qZA()()),2&o){const t=s.$implicit,i=e.oxw(3);e.xp6(2),e.Q6J("routerLink","/"+i.routeConstants.workItemPath+"/"+t.workItemId),e.xp6(1),e.hij(" ",t.workItemId," "),e.xp6(2),e.Q6J("routerLink","/"+i.routeConstants.workOrderPath+"/"+t.workOrderId),e.xp6(1),e.hij(" ",t.workOrderId," "),e.xp6(2),e.hij(" ",t.workItemDescription," "),e.xp6(2),e.hij(" ",e.lcZ(11,7,t.createdOn)," "),e.xp6(3),e.hij(" ",e.lcZ(14,9,t.workState)," ")}}function L(o,s){if(1&o&&(e.TgZ(0,"div",11)(1,"h4",12),e._uU(2,"Trabajos asignados"),e.qZA(),e.TgZ(3,"table",13)(4,"thead")(5,"tr")(6,"th"),e._uU(7,"Id"),e.qZA(),e.TgZ(8,"th"),e._uU(9,"OT"),e.qZA(),e.TgZ(10,"th"),e._uU(11,"Descripci\xf3n"),e.qZA(),e.TgZ(12,"th"),e._uU(13,"Fecha de creaci\xf3n"),e.qZA(),e.TgZ(14,"th"),e._uU(15,"Estado"),e.qZA()()(),e.TgZ(16,"tbody"),e.YNc(17,D,15,11,"tr",14),e.qZA()()()),2&o){const t=e.oxw(2);e.xp6(17),e.Q6J("ngForOf",t.user.assignedWorkItems)}}function G(o,s){if(1&o&&(e.TgZ(0,"div",11)(1,"h4",12),e._uU(2,"Salidas de herramienta"),e.qZA(),e._UZ(3,"output-tool-list",16),e.qZA()),2&o){const t=e.oxw(2);e.xp6(3),e.Q6J("outputsTool",t.user.outputsTool)}}function j(o,s){if(1&o&&(e.TgZ(0,"div",1)(1,"h2",2),e._uU(2,"Detalle de usuario"),e.qZA(),e.YNc(3,S,3,0,"div",3),e.ALo(4,"userRoles"),e.YNc(5,Y,1,1,"app-user-detail-view",4),e.YNc(6,Q,1,2,"app-user-detail-edit",5),e.YNc(7,L,18,1,"div",6),e.YNc(8,G,4,1,"div",6),e.qZA()),2&o){const t=e.oxw();e.xp6(3),e.Q6J("ngIf",e.lcZ(4,5,t.userRolesEnum.UsersAdmin)&&!t.isEditing),e.xp6(2),e.Q6J("ngIf",!t.isEditing),e.xp6(1),e.Q6J("ngIf",t.isEditing),e.xp6(1),e.Q6J("ngIf",t.user.assignedWorkItems&&t.user.assignedWorkItems.length),e.xp6(1),e.Q6J("ngIf",t.user.outputsTool&&t.user.outputsTool.length)}}class h{constructor(s,t){this.route=s,this.httpService=t,this.isEditing=!1,this.routeConstants=u.p7,this.userRolesEnum=x.v}ngOnInit(){this.getUser(),this.getUserRoles()}getUser(){const s=this.route.snapshot.paramMap.get("id");this.httpService.get(`${u.G8.userEmployeeApi}/${s}`).subscribe(t=>this.user=t)}getUserRoles(){this.httpService.get(`${u.G8.userRolesApi}`).subscribe(s=>this.userRoles=s)}setIsEditing(s){this.isEditing=s}userUpdated(){this.setIsEditing(!1),this.getUser()}static#e=this.\u0275fac=function(t){return new(t||h)(e.Y36(d.gz),e.Y36(p.O))};static#t=this.\u0275cmp=e.Xpm({type:h,selectors:[["app-users-management-detail"]],decls:1,vars:1,consts:[["class","container",4,"ngIf"],[1,"container"],[1,"text-center","mt-3"],["class","d-flex justify-content-center",4,"ngIf"],[3,"user",4,"ngIf"],[3,"user","userRoles","cancelEditEvent","userUpdatedEvent",4,"ngIf"],["class","row mt-3",4,"ngIf"],[1,"d-flex","justify-content-center"],["type","button",1,"btn","btn-outline-primary",3,"click"],[3,"user"],[3,"user","userRoles","cancelEditEvent","userUpdatedEvent"],[1,"row","mt-3"],[1,"text-center","mb-3"],[1,"table","table-hover"],[4,"ngFor","ngForOf"],[3,"routerLink"],[3,"outputsTool"]],template:function(t,i){1&t&&e.YNc(0,j,9,7,"div",0),2&t&&e.Q6J("ngIf",i.user)},dependencies:[a.sg,a.O5,d.rH,f,_,g,a.uU,M.$,O.Y]})}var V=r(5698),b=r(9453),$=r(3143);function H(o,s){if(1&o){const t=e.EpF();e.TgZ(0,"li")(1,"div",21)(2,"input",22),e.NdJ("change",function(n){e.CHM(t);const c=e.oxw(2);return e.KtG(c.setUserRoleValue(n))}),e.qZA(),e.TgZ(3,"label",23),e._uU(4),e.qZA()()()}if(2&o){const t=s.$implicit;e.xp6(2),e.Q6J("value",t.userRoleId)("id","userRoles-"+t.userRoleId),e.xp6(1),e.uIk("for","userRoles-"+t.userRoleId),e.xp6(1),e.hij(" ",t.displayName," ")}}function K(o,s){if(1&o){const t=e.EpF();e.TgZ(0,"form",9),e.NdJ("ngSubmit",function(){e.CHM(t);const n=e.oxw();return e.KtG(n.addUserForm.valid&&n.onSubmit())}),e.TgZ(1,"div",10)(2,"div",11)(3,"label",12),e._uU(4,"Nombre"),e.qZA(),e._UZ(5,"input",13),e.qZA(),e.TgZ(6,"div",11)(7,"label",14),e._uU(8,"Email"),e.qZA(),e._UZ(9,"input",15),e.qZA(),e.TgZ(10,"div",11)(11,"label",16),e._uU(12,"Identificaci\xf3n"),e.qZA(),e._UZ(13,"input",17),e.qZA(),e.TgZ(14,"div",18)(15,"p"),e._uU(16,"Roles"),e.qZA(),e.TgZ(17,"ul",19),e.YNc(18,H,5,4,"li",20),e.qZA()()()()}if(2&o){const t=e.oxw();e.Q6J("formGroup",t.addUserForm),e.xp6(18),e.Q6J("ngForOf",t.userRoles)}}class v{constructor(s,t,i,n){this.activeModal=s,this.fb=t,this.httpService=i,this.accoutService=n,this.UserAddedEvent=new e.vpe,this.accoutService.currentAccount$.pipe((0,V.q)(1)).subscribe(c=>this.user=c)}ngOnInit(){this.initForm()}initForm(){this.addUserForm=this.fb.group({name:["",l.kI.required],email:[null],idCard:["",l.kI.required],userRoles:[null,this.rolesLengthValidator]})}onSubmit(){const s={company:this.user.company,email:this.addUserForm.controls.email.value,idCard:parseInt(this.addUserForm.controls.idCard.value),name:this.addUserForm.controls.name.value,userRoles:this.addUserForm.controls.userRoles.value.map(t=>({userRoleId:t}))};this.httpService.post(u.G8.addUserApi,s).subscribe(t=>{this.activeModal.close(!0)})}setUserRoleValue(s){const t=this.userRoles.findIndex(i=>i.userRoleId==s.target.value);this.userRoles[t].isActive=s.target.checked,this.filterUserRoleFormValues()}filterUserRoleFormValues(){this.addUserForm?.patchValue({userRoles:this.userRoles.filter(s=>s.isActive).map(s=>s.userRoleId)})}rolesLengthValidator(s){return s.value&&s.value.length?null:{invalidCustomValue:!0}}static#e=this.\u0275fac=function(t){return new(t||v)(e.Y36(b.Kz),e.Y36(l.qu),e.Y36(p.O),e.Y36($.B))};static#t=this.\u0275cmp=e.Xpm({type:v,selectors:[["app-add-user-modal"]],inputs:{userRoles:"userRoles"},outputs:{UserAddedEvent:"UserAddedEvent"},decls:13,vars:2,consts:[[1,"modal-header"],[1,"modal-title","pull-left"],["type","button","aria-label","Close",1,"btn-close","close","pull-right",3,"click"],["aria-hidden","true",1,"visually-hidden"],[1,"modal-body"],[3,"formGroup","ngSubmit",4,"ngIf"],[1,"modal-footer"],["type","button",1,"btn","btn-outline-danger",3,"click"],[1,"btn","btn-outline-primary",3,"disabled","click"],[3,"formGroup","ngSubmit"],[1,"row","g-2"],[1,"col-md-6"],["for","name",1,"form-label"],["type","text","formControlName","name",1,"form-control"],["for","email",1,"form-label"],["type","email","formControlName","email",1,"form-control"],["for","idCard",1,"form-label"],["type","text","formControlName","idCard",1,"form-control"],[1,"col-12"],[1,"list-unstyled"],[4,"ngFor","ngForOf"],[1,"form-check"],["type","checkbox",1,"form-check-input",3,"value","id","change"],[1,"form-check-label"]],template:function(t,i){1&t&&(e.TgZ(0,"div",0)(1,"h4",1),e._uU(2,"Agregar Nuevo Usuario"),e.qZA(),e.TgZ(3,"button",2),e.NdJ("click",function(){return i.activeModal.close(!1)}),e.TgZ(4,"span",3),e._uU(5,"\xd7"),e.qZA()()(),e.TgZ(6,"div",4),e.YNc(7,K,19,2,"form",5),e.qZA(),e.TgZ(8,"div",6)(9,"button",7),e.NdJ("click",function(){return i.activeModal.dismiss()}),e._uU(10,"Cancelar"),e.qZA(),e.TgZ(11,"button",8),e.NdJ("click",function(){return i.onSubmit()}),e._uU(12,"Enviar"),e.qZA()()),2&t&&(e.xp6(7),e.Q6J("ngIf",i.addUserForm),e.xp6(4),e.Q6J("disabled",!i.addUserForm.valid))},dependencies:[a.sg,a.O5,l._Y,l.Fj,l.JJ,l.JL,l.sg,l.u]})}class m{constructor(s){this.httpService=s}getUserRoles(){return this.httpService.get(u.G8.userRolesApi)}static#e=this.\u0275fac=function(t){return new(t||m)(e.LFG(p.O))};static#t=this.\u0275prov=e.Yz7({token:m,factory:m.\u0275fac,providedIn:"root"})}var B=r(8073),z=r(5090);class U{constructor(s,t,i,n){this.modalService=s,this.httpService=t,this.router=i,this.usersService=n}ngOnInit(){this.getUsersList(),this.getUserRoles()}onOpenAddUserModal(){this.modalRef=this.modalService.open(v,{size:"lg"}),this.modalRef.componentInstance.userRoles=this.userRoles,this.modalRef.closed.subscribe(s=>s&&this.getUsersList())}getUsersList(){this.httpService.get("Users/employees").subscribe(s=>this.users=s)}onUserClicked(s){this.router.navigateByUrl(`/${u.p7.usersManagement}/${s.id}`)}getUserRoles(){this.usersService.getUserRoles().subscribe(s=>this.userRoles=s)}static#e=this.\u0275fac=function(t){return new(t||U)(e.Y36(b.FF),e.Y36(p.O),e.Y36(d.F0),e.Y36(m))};static#t=this.\u0275cmp=e.Xpm({type:U,selectors:[["app-users-management"]],decls:10,vars:4,consts:[[1,"container"],[1,"text-center","mt-3"],[1,"btn","btn-outline-primary",3,"click"],[3,"items","rowClickedEvent"]],template:function(t,i){1&t&&(e.TgZ(0,"div",0)(1,"h2",1),e._uU(2,"Administraci\xf3n de usuarios"),e.qZA(),e.TgZ(3,"div",1)(4,"button",2),e.NdJ("click",function(){return i.onOpenAddUserModal()}),e._uU(5,"Agregar usuario"),e.qZA()(),e.TgZ(6,"h4",1),e._uU(7,"Lista de usuarios"),e.qZA(),e.TgZ(8,"app-items-list",3),e.NdJ("rowClickedEvent",function(c){return i.onUserClicked(c)}),e.ALo(9,"toItemList"),e.qZA()()),2&t&&(e.xp6(8),e.Q6J("items",e.xi3(9,1,i.users,"user")))},dependencies:[B.H,z.R]})}const X=[{path:"",component:U},{path:":id",component:h}];class Z{static#e=this.\u0275fac=function(t){return new(t||Z)};static#t=this.\u0275mod=e.oAB({type:Z});static#s=this.\u0275inj=e.cJS({imports:[d.Bz.forChild(X),d.Bz]})}var W=r(6619),P=r(9127);class T{static#e=this.\u0275fac=function(t){return new(t||T)};static#t=this.\u0275mod=e.oAB({type:T});static#s=this.\u0275inj=e.cJS({imports:[a.ez,Z,W.m,P.I]})}}}]);